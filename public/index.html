<!doctype html>
<html lang="en">

<head>
    <title>NodeJS Pagination</title>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="/bootstrap/css/bootstrap.min.css">
</head>

<body class="bg-light">

    <div class="container my-5">
        <div class="row">
            <div class="col">
                <h1 class="mb-4">üê† Pagination Front to Back</h1>

                <div class="input-group mb-3">
                    <input type="text" name="search" id="search" class="form-control" placeholder="Search..."
                        onkeyup="search()">
                    <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown"
                        aria-expanded="false">Order</button>
                    <ul class="dropdown-menu dropdown-menu-end">
                        <li><button class="dropdown-item" type="button" onclick="order(this, 'Name')">Name</button></li>
                        <li><button class="dropdown-item" type="button" onclick="order(this, 'Salary')">Salary</button></li>
                        <li><button class="dropdown-item" type="button" onclick="order(this, 'Code')">Code</button></li>
                        <li><button class="dropdown-item" type="button" onclick="order(this, 'Job')">Job</button></li>
                        <li><button class="dropdown-item" type="button" onclick="order(this, 'Department')">Department</button></li>
                    </ul>
                </div>

                <div id="employees"></div>
                <nav>
                    <ul class="pagination justify-content-center">
                        <li id="prev" class="page-item">
                            <a class="page-link" href="#" onclick="prev()">Previous</a>
                        </li>
                        <!-- <li class="page-item"><a class="page-link" href="#">1</a></li> -->
                        <li id="next" class="page-item">
                            <a class="page-link" href="#" onclick="next()">Next</a>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>
    </div>

    <script src="/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script>
        let page = 1;
        let total = 0;
        let filtered = 0;
        let size = 5;
        let searchText = '';
        let orderBy = 'Name';
        let orderDir = 'ASC';

        const dvEmployees = document.getElementById('employees');

        getEmployees();

        function getEmployees() {
            const apiUrl = `http://localhost:3000/api/employees?page=${page}&size=${size}&search=${searchText}&orderBy=${orderBy}&orderDir=${orderDir}`;
            const xhr = new XMLHttpRequest();
            xhr.onload = () => {
                if (xhr.status === 200) {
                    const result = JSON.parse(xhr.responseText);
                    console.log(result);

                    total = result.total;
                    filtered = result.filtered;

                    document.querySelectorAll(".page-number").forEach(el => el.remove());

                    const btnPrevious = document.getElementById('next');
                    for (let index = 0; index < Math.ceil(filtered / size); index++) {
                        btnPrevious.insertAdjacentHTML('beforebegin', `
                            <li class="page-item ${page === index + 1 ? 'active' : ''}"><a class="page-link page-number" href="#" onclick="to(${index + 1})">${index + 1}</a></li>
                        `);
                    }

                    let employeeHtml = '';
                    result.records.forEach(employee => {
                        employeeHtml += `
                            <div class="card mb-3">
                                <div class="card-body">
                                    <span class="badge bg-secondary float-end">${employee.Code}</span>
                                    <h4 class="card-title">
                                        ${employee.Name}
                                    </h4>
                                    <p class="card-text">
                                        ${employee.Job}, ${employee.Department} | ${employee.Salary}
                                    </p>
                                </div>
                            </div>
                        `;
                    });
                    dvEmployees.innerHTML = employeeHtml;
                }
            };
            xhr.open('GET', apiUrl, true);
            xhr.send();
        }

        function next() {
            const exist = ((size * (page + 1)) - size) < filtered;
            if (exist) {
                ++page;
                getEmployees();
            }
        }

        function prev() {
            if (page > 1) {
                --page;
                getEmployees();
            }
        }

        function to(pageNo) {
            page = pageNo;
            getEmployees();
        }

        function search() {
            const searched = document.getElementById('search').value;
            if (searched) {
                if (searchText !== searched) {
                    searchText = searched;
                    page = 1;
                    getEmployees();
                }
            } else {
                searchText = '';
                page = 1;
                getEmployees();
            }
        }

        function order(element, by) {
            orderBy = by;
            orderDir = orderDir === 'ASC' ? 'DESC' : 'ASC';
            getEmployees();
        }
    </script>
</body>

</html>